# Enhanced Configuration for System Reliability Features
# Sprint 1.1 (003-system-reliability)

# Collection settings (unchanged)
collection:
  interval_seconds: 300
  retry_attempts: 3
  retry_backoff_base: 1.0

# Storage settings (enhanced for WAL mode and retry logic)
storage:
  database_path: "data/readings.db"
  enable_pooling: false

  # NEW: Write-Ahead Logging mode
  enable_wal_mode: true
  wal_checkpoint_interval: 1000 # Checkpoint every 1000 writes (0 = auto)

  # NEW: Database retry configuration
  retry_max_attempts: 3 # Number of retry attempts for database locked errors
  retry_base_delay: 1.0 # Base delay in seconds for exponential backoff (1s, 2s, 4s)
  busy_timeout_ms: 5000 # SQLite busy timeout (milliseconds)

# Logging settings (enhanced for rotation)
logging:
  level: "INFO"
  enable_file_logging: true
  log_file_path: "logs/hue_collection.log"

  # NEW: Rotation configuration
  max_bytes: 10485760 # 10MB - rotate when file reaches this size
  backup_count: 5 # Keep 5 backup files (total max: 60MB)
  encoding: "utf-8" # Log file encoding

# Validation settings (unchanged)
validation:
  indoor_temp_min: 0
  indoor_temp_max: 40
  outdoor_temp_min: -40
  outdoor_temp_max: 50
  allow_out_of_range: true

# Collector-specific settings (unchanged)
collectors:
  hue:
    enabled: true
    timeout_seconds: 10
    bridge_ip: null # Auto-discover if null
    auto_discover: true
    collection_interval: 300
    retry_attempts: 3
    retry_backoff_base: 2
    sensor_locations:
      "00:17:88:01:02:02:b5:21-02-0402": "Utility"
      "00:17:88:01:03:28:0f:d0-02-0402": "Hall"
    fallback_to_name: true
    temperature_min: 0.0
    temperature_max: 40.0
    collect_battery_level: true
    collect_signal_strength: true
    collect_raw_response: false

  nest:
    enabled: false
    timeout_seconds: 10

  weather:
    enabled: false
    timeout_seconds: 10
